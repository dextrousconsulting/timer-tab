{"version":3,"sources":["webpack:///./tab-utils/views/FullViewWrapper/screen-buttons.js","webpack:///./tab-utils/views/FullViewWrapper/on_page_load.js","webpack:///./tab-utils/views/FullViewWrapper/index.js","webpack:///./tab-utils/views/common/show_toast.js","webpack:///./tab-utils/make_element_zoomable.js"],"names":["activate_screen_buttons","scroll_button","document","querySelector","fullscreen_button","full_view","onclick","do_scroll","stop_auto_scroll","counter","repeater","scroll_button_text","addScrollListener","scrollListener","onlyUserScroll","fireInitialScroll","start_auto_scroll","show","auto_duration","time_step","assert","internal","hide","window","clearTimeout","set","classList","textContent","hidden","setTimeout","scrollPos","is_user_scroll","fullscreenElement","exitFullscreen","activate_auto_scroll","scrollToElement","documentElement","requestFullscreen","show_toast","is_error","short_duration","requestAnimationFrame","activate_view_buttons","open","toggle_zoom","on_page_load","onPageLoad","goldpage_args","load_full_view","load_common","pretty_scroll_area","FullViewLayout","props","id","FullView","children","Header","className","ScreenButton","click-name","LeftSide","style","position","RightSide","MorePanel","Footer","config","conf","renderToDom","renderToHtml","favicon","tab_app_logo","text","backgroundColor","duration","Toastify","showToast","_toggle_zoom","is_zoomed","make_element_zoomable","last_size","containerEl","scaleEl","zoomEl","toggleEl","add","addEventListener","ev","propertyName","on_transition_start","passive","remove","last_state","on_zoom_end_listeners","forEach","listener","auto_scroll","x","y","size","innerWidth","innerHeight","set_zoom","getElementSizes","zoom_el_height","height","zoom_el_width","width","container_height","container_width","log_data","scale_el_pos__absolute","getPosition","zoom_el_pos__absolute","zoom_el_pos__relative","zoom_el_pos","scale","Math","min","screen_center","zoom_el_center","translation","setProperty","zoomIn","zoomOut","track_event","name","scrollToHideScrollElement","on_zoom_end","push","getSize","el","styleProp","computed_style","get_computed_style","parseInt","defaultView","getComputedStyle","getPropertyValue","getOuterSize","d","map","di","reduce","i1","i2","left","top","current_el","offsetLeft","offsetTop","offsetParent"],"mappings":"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","file":"views/SeriesPage/series.page.ts~views/TimerPage/timer.page.js.hash_80ecc17acd37adf1d728.js","sourcesContent":["import assert from \"@brillout/assert\";\nimport { scrollToElement, addScrollListener } from \"../../pretty_scroll_area\";\nimport { show_toast } from \"../common/show_toast\";\nimport { user_donated } from \"../../load_ad\";\nimport { toggle_zoom } from \"../../make_element_zoomable\";\n\nexport { activate_screen_buttons };\n\nfunction activate_screen_buttons() {\n  activate_view_buttons();\n  activate_settings_button();\n  activate_donate_button();\n  activate_thanks_button();\n  activate_zoom_button();\n}\n\nfunction activate_zoom_button() {\n  const zoom_button = document.querySelector(\"#zoom-button\");\n  zoom_button.onclick = () => {\n    toggle_zoom();\n  };\n}\n\nfunction activate_settings_button() {\n  const settings_button = document.querySelector(\"#settings-button\");\n  settings_button.onclick = () => {\n    scrollToElement(\"#more_panel\");\n  };\n}\n\nfunction activate_donate_button() {\n  const donate_button = document.querySelector(\"#donate-button\");\n  donate_button.onclick = () => {\n    window.open(\"/donate\", \"_self\");\n  };\n}\n\nfunction activate_thanks_button() {\n  const donate_button = document.querySelector(\"#thanks-button\");\n  donate_button.onclick = () => {\n    window.open(\"/thanks\", \"_self\");\n  };\n}\n\nfunction activate_view_buttons() {\n  const scroll_button = document.querySelector(\"#center-button\");\n  const fullscreen_button = document.querySelector(\"#fullscreen-button\");\n  const full_view = document.querySelector(\n    \".pretty_scroll_area__hide_scroll_element\"\n  );\n\n  scroll_button.onclick = do_scroll;\n  fullscreen_button.onclick = do_fullscreen;\n\n  const stop_auto_scroll = activate_auto_scroll({ do_scroll });\n\n  return;\n\n  async function do_scroll() {\n    stop_auto_scroll();\n    await scrollToElement(full_view);\n  }\n  async function do_fullscreen() {\n    try {\n      await document.documentElement.requestFullscreen();\n    } catch (err) {\n      show_toast(\"Your browser doesn't support fullscreen.\", {\n        is_error: true,\n        short_duration: true,\n      });\n      return;\n    }\n    // When tab goes to fullscreen, scroll is changed; ensure with `requestAnimationFrame` that\n    // scrolling happens *after* the tab goes fullscreen.\n    requestAnimationFrame(async () => {\n      await do_scroll();\n    });\n  }\n}\n\n/*/\nlet auto_duration = 1000;\n/*/\nlet auto_duration = 4;\n//*/\nfunction activate_auto_scroll({ do_scroll }) {\n  const scroll_button = document.querySelector(\"#center-button\");\n  const scroll_button_text = scroll_button.querySelector(\".button-text\");\n  const active_class = \"auto-scroll-is-active\";\n\n  addScrollListener(scrollListener, {\n    onlyUserScroll: false,\n    fireInitialScroll: false,\n  });\n  start_auto_scroll();\n\n  return stop_auto_scroll;\n\n  var counter;\n  var repeater;\n  function start_auto_scroll() {\n    show();\n    if (repeater) return;\n    counter = auto_duration;\n    auto_duration = 10;\n    time_step();\n    assert.internal(repeater);\n  }\n  function stop_auto_scroll() {\n    hide();\n    if (repeater) {\n      window.clearTimeout(repeater);\n      repeater = null;\n    }\n  }\n\n  function set(hide = false) {\n    scroll_button.classList[hide ? \"remove\" : \"add\"](active_class);\n    scroll_button_text.textContent = hide ? \"\" : \" \" + (counter | 0) + \"s\";\n  }\n  function show() {\n    set();\n  }\n  function hide() {\n    set(true);\n  }\n\n  function time_step() {\n    assert(counter >= 0);\n\n    if (!document.hidden) {\n      counter--;\n      if ((counter | 0) === counter) {\n        updateDom();\n        if (counter === 0) {\n          do_scroll();\n          stop_auto_scroll();\n          assert.internal(repeater === null);\n          return;\n        }\n      }\n    }\n    repeater = window.setTimeout(time_step, 1000);\n  }\n\n  function updateDom() {\n    if (!counter) {\n      hide();\n    } else {\n      show();\n    }\n  }\n\n  function scrollListener(scrollPos, { is_user_scroll }) {\n    if (is_user_scroll && document.fullscreenElement) {\n      document.exitFullscreen();\n    }\n\n    if (scrollPos === 0) {\n      start_auto_scroll();\n    } else {\n      stop_auto_scroll();\n    }\n  }\n}\n","import load_common from \"../common/load_common\";\nimport pretty_scroll_area from \"../../pretty_scroll_area\";\nimport { activate_screen_buttons } from \"./screen-buttons\";\n\nexport default on_page_load;\n\nasync function on_page_load(onPageLoad, goldpage_args) {\n  await onPageLoad(() => {\n    load_full_view();\n    load_common();\n  }, goldpage_args);\n}\n\nfunction load_full_view() {\n  pretty_scroll_area();\n\n  activate_screen_buttons();\n}\n","import assert from \"@brillout/assert\";\nimport React from \"react\";\nimport Header from \"../Header\";\nimport Footer from \"../Footer\";\nimport \"./full-view.css\";\nimport on_page_load from \"./on_page_load\";\nimport { tab_app_logo } from \"../../../tab_app_info\";\n\nexport { FullView, MorePanel, LeftSide, RightSide, FullViewLayout, config };\n\nfunction FullViewLayout(props) {\n  assert(!props.id);\n  return <div id=\"fv_full-view-layout\" {...props} />;\n}\n\nfunction FullView(props) {\n  const { children } = props;\n  return (\n    <>\n      <Header />\n\n      <div\n        className=\"pretty_scroll_area__hide_scroll_element load-area\"\n        {...props}\n      >\n        {children}\n        <div id=\"screen-buttons-wrapper\">\n          <ScreenButton id=\"donate-button\" />\n          <ScreenButton id=\"center-button\" />\n          <ScreenButton id=\"fullscreen-button\" />\n          <ScreenButton id=\"zoom-button\" />\n          <ScreenButton id=\"settings-button\" />\n          <ScreenButton id=\"thanks-button\" />\n          <ScreenButton id=\"width-setter-button\" />\n        </div>\n      </div>\n    </>\n  );\n}\n\nfunction ScreenButton({ id }) {\n  return (\n    <div id={id} click-name={id} className=\"screen-button\">\n      <div className=\"button-background glass-background\" />\n      <span className=\"button-icon\"></span>\n      <span className=\"button-text\"></span>\n    </div>\n  );\n}\n\nfunction LeftSide({ children, ...props }) {\n  assert(!props.id);\n  return (\n    <div\n      id=\"fv_left-side\"\n      {...props}\n      click-name=\"fv_left-side\"\n      style={{\n        position: \"relative\",\n      }}\n    >\n      <div id=\"fv_left-side_background\" className=\"glass-background\" />\n      {children}\n    </div>\n  );\n}\n\nfunction RightSide(props) {\n  assert(!props.id);\n  return <div id=\"fv_right-side\" {...props} />;\n}\n\nfunction MorePanel(props) {\n  const { children } = props;\n  return (\n    <div id=\"more_panel\">\n      <div id=\"more_panel_background\" className=\"glass-background\"></div>\n      {children}\n      <Footer />\n    </div>\n  );\n}\n\nfunction config({ onPageLoad, ...conf }) {\n  return {\n    renderToDom: true,\n    renderToHtml: true,\n    favicon: tab_app_logo,\n    ...conf,\n    on_page_load: (goldpage_args) => on_page_load(onPageLoad, goldpage_args),\n  };\n}\n","import assert from \"@brillout/assert\";\nimport Toastify from \"toastify-js\";\nimport \"toastify-js/src/toastify.css\";\nimport \"./toast.css\";\n\nexport { show_toast };\n\nfunction show_toast(text, { is_error = false, short_duration = false } = {}) {\n  assert(text);\n\n  const backgroundColor = is_error\n    ? \"linear-gradient(to right, #e83131, #dd4c4c)\"\n    : \"linear-gradient(to right, rgb(0, 176, 84), rgb(61, 201, 64))\";\n\n  const duration = short_duration ? 4 : 8;\n\n  Toastify({\n    duration: duration * 1000,\n    text,\n    position: \"left\",\n    backgroundColor,\n    // className: \"info\",\n  }).showToast();\n}\n","import assert from \"@brillout/assert\";\nimport { track_event } from \"./views/common/tracker\";\nimport \"./make_element_zoomable.css\";\nimport { scrollToHideScrollElement } from \"./pretty_scroll_area\";\n\nexport { make_element_zoomable };\nexport let is_zoomed = null;\nexport { on_zoom_end };\nexport { toggle_zoom };\n\n/*\nconst DEBUG = true;\n/*/\nconst DEBUG = false;\n//*/\n\n// zoomEl: target that is being zoomed into\n// scaleEl: element on which CSS Transform is applied\n// containerEl: container that the zoomed element fully fills\n// toggleEl: click element that toggles zoom state\nfunction make_element_zoomable({ containerEl, scaleEl, zoomEl, toggleEl }) {\n  assert(containerEl && scaleEl && zoomEl);\n  toggleEl = toggleEl || zoomEl;\n\n  DEBUG && console.log(\"[zoom] setup\", { zoomEl, scaleEl, containerEl });\n  if (DEBUG && window.location.hostname === \"localhost\") {\n    // Show cursor position\n    document.onmousemove = function (e) {\n      var x = e.pageX;\n      var y = e.pageY;\n      e.target.title = \"X is \" + x + \" and Y is \" + y;\n    };\n  }\n\n  scaleEl.classList.add(\"zooming__scaler\");\n  containerEl.classList.add(\"zooming__overflow-container\");\n  zoomEl.classList.add(\"zooming__zoomable-element\");\n\n  scaleEl.addEventListener(\n    \"transitionstart\",\n    (ev) => {\n      ev.propertyName === \"transform\" && on_transition_start();\n    },\n    { passive: true }\n  );\n  scaleEl.addEventListener(\n    \"transitionend\",\n    (ev) => {\n      ev.propertyName === \"transform\" && on_transition_end();\n    },\n    { passive: true }\n  );\n\n  toggleEl.addEventListener(\"click\", on_click, { passive: true });\n  window.addEventListener(\"resize\", on_resize, { passive: true });\n\n  assert(is_zoomed === null, \"multiple zoomable elements are not supported.\");\n  is_zoomed = false;\n\n  _toggle_zoom = toggle_zoom;\n\n  return;\n\n  function set_zoom() {\n    if (is_zoomed === true) {\n      zoomIn({ zoomEl, scaleEl, containerEl });\n    } else {\n      zoomOut({ scaleEl, containerEl });\n    }\n  }\n\n  function toggle_zoom({ auto_scroll = false } = {}) {\n    on_transition_start();\n\n    is_zoomed = !is_zoomed;\n\n    track_event({ name: is_zoomed ? \"zoom_in\" : \"zoom_out\" });\n\n    if (auto_scroll && is_zoomed) {\n      scrollToHideScrollElement();\n    }\n\n    set_zoom();\n  }\n\n  function on_click() {\n    toggle_zoom({ auto_scroll: true });\n  }\n\n  var last_size;\n  function on_resize() {\n    last_size = last_size || { x: null, y: null };\n    const size = { x: window.innerWidth, y: window.innerHeight };\n    if (last_size.x === size.x && last_size.y === size.y) {\n      return;\n    }\n    last_size = size;\n    set_zoom();\n  }\n\n  function on_transition_start() {\n    containerEl.classList.add(\"zoom-transition\");\n  }\n  function on_transition_end() {\n    containerEl.classList.remove(\"zoom-transition\");\n    call_zoom_state_listeners();\n  }\n}\n\nlet _toggle_zoom;\nfunction toggle_zoom() {\n  _toggle_zoom();\n}\n\nconst on_zoom_end_listeners = [];\nfunction on_zoom_end(listener) {\n  on_zoom_end_listeners.push(listener);\n}\nlet last_state;\nfunction call_zoom_state_listeners() {\n  if (last_state === is_zoomed) return;\n  last_state = is_zoomed;\n  if (is_zoomed) {\n    on_zoom_end_listeners.forEach((listener) => {\n      listener();\n    });\n  }\n}\n\nfunction zoomIn({ zoomEl, scaleEl, containerEl }) {\n  const { height: zoom_el_height, width: zoom_el_width } = getElementSizes(\n    zoomEl\n  );\n  const { height: container_height, width: container_width } = getElementSizes(\n    containerEl\n  );\n  const log_data = {\n    zoom_el_width,\n    zoom_el_height,\n    zoomEl,\n    container_width,\n    container_height,\n    containerEl,\n  };\n  assert(\n    zoom_el_height && zoom_el_width && container_height && container_width,\n    \"[zoom-problem]\",\n    log_data\n  );\n  DEBUG && console.log(\"[zoom]\", log_data);\n\n  const scale_el_pos__absolute = getPosition(scaleEl);\n  const zoom_el_pos__absolute = getPosition(zoomEl);\n  const zoom_el_pos__relative = {\n    x: zoom_el_pos__absolute.x - scale_el_pos__absolute.x,\n    y: zoom_el_pos__absolute.y - scale_el_pos__absolute.y,\n  };\n  const zoom_el_pos = zoom_el_pos__relative;\n  DEBUG &&\n    console.log(\n      \"[zoom]\",\n      JSON.stringify({\n        zoom_el_pos__relative,\n        zoom_el_pos__absolute,\n        scale_el_pos__absolute,\n      })\n    );\n\n  const scale = Math.min(\n    container_height / zoom_el_height,\n    container_width / zoom_el_width\n  );\n  DEBUG && console.log(\"[zoom]\", JSON.stringify({ scale }));\n\n  const screen_center = [container_width / 2, container_height / 2];\n  const zoom_el_center = [\n    zoom_el_width / 2 + zoom_el_pos.x,\n    zoom_el_height / 2 + zoom_el_pos.y,\n  ];\n  const translation = [\n    screen_center[0] - zoom_el_center[0],\n    screen_center[1] - zoom_el_center[1],\n  ];\n  DEBUG &&\n    console.log(\n      \"[zoom]\",\n      JSON.stringify({ screen_center, zoom_el_center, translation })\n    );\n\n  scaleEl.style.setProperty(\"--scale\", scale);\n  scaleEl.style.setProperty(\"--zoom-center-x\", zoom_el_center[0] + \"px\");\n  scaleEl.style.setProperty(\"--zoom-center-y\", zoom_el_center[1] + \"px\");\n  scaleEl.style.setProperty(\"--translate-x\", translation[0] + \"px\");\n  scaleEl.style.setProperty(\"--translate-y\", translation[1] + \"px\");\n  document.documentElement.classList.add(\"zoomed-state\");\n  /* Playground: http://jsfiddle.net/2sqprjot/ */\n}\n\nfunction zoomOut({ scaleEl, containerEl }) {\n  document.documentElement.classList.remove(\"zoomed-state\");\n}\n\n// Old code\n//  - Shortcut keybinding\n//  - #fullscreen URL hash\n\n/*\n  var fullscreen_toggle;\n  var hashListener;\n  //{{{\n  (function()\n  {\n    var FULLSCREEN_HASH = 'fullscreen';\n\n    function isFullscreen(){return location.hash==='#'+FULLSCREEN_HASH}\n    el.unfullscreen=function(){if(isFullscreen()) location.hash=''};\n\n    fullscreen_toggle=function()\n    //{{{\n    {\n      location.hash=isFullscreen()?'':FULLSCREEN_HASH;\n    //dom_fullscreen_toggle();\n    };\n    //}}}\n\n    (function(){\n      var isFs;\n      var last_isFs;\n      hashListener=function(){\n        ml.reqFrame(function(){\n          if(!last_isFs || last_isFs!=isFs) {\n          //dom_fullscreen_toggle();\n            last_isFs=isFs;\n          }\n          if(isFullscreen()) {\n            fsFcts[0]();\n            isFs=true;\n          }\n          else {\n            //if(location.hash) location.hash='#';\n            fsFcts[1]();\n            isFs=false;\n          }\n        });\n      }\n    })();\n  })();\n  //}}}\n\n  el.addEventListener('click',fullscreen_toggle,false);\n  if(keybinding) window.addEventListener('keydown',function(ev)\n  //{{{\n  {\n    ev = ev || window.event;\n    if(ml.controlKeyPressed(ev)) return;\n    var targetType = ml.getEventSource(ev).type;\n    if(targetType==='text' || targetType==='url') return;\n    if(ml.getChar(ev)===keybinding) fullscreen_toggle();\n  },false);\n  //}}}\n\n  hashListener();\n  ml.addHashListener(hashListener);\n  window.addEventListener('resize',function() { setTimeout(hashListener,1); },false);\n  return hashListener;\n  */\n\nfunction getSize(el, styleProp) {\n  const computed_style = get_computed_style(el, styleProp);\n  return parseInt(computed_style, 10) || 0;\n}\n\nfunction get_computed_style(el, styleProp) {\n  return document.defaultView\n    .getComputedStyle(el, null)\n    .getPropertyValue(styleProp);\n}\n\nfunction getElementSizes(el) {\n  let height = getSize(el, \"height\");\n  let width = getSize(el, \"width\");\n\n  const box_sizing = get_computed_style(el, \"box-sizing\");\n  if (box_sizing !== \"border-box\") {\n    height += getOuterSize([\"top\", \"bottom\"]);\n    width += getOuterSize([\"left\", \"right\"]);\n  }\n\n  return { height, width };\n\n  function getOuterSize(d) {\n    return d\n      .map(function (di) {\n        const paddingSize = getSize(el, \"padding-\" + di);\n        const borderSize = getSize(el, \"border-\" + di);\n        return paddingSize + borderSize;\n      })\n      .reduce(function (i1, i2) {\n        return i1 + i2;\n      });\n  }\n}\n\nfunction getPosition(el) {\n  let left = 0;\n  let top = 0;\n  let current_el = el;\n  do {\n    left += current_el.offsetLeft;\n    top += current_el.offsetTop;\n  } while ((current_el = current_el.offsetParent));\n  return { x: left, y: top };\n}\n"],"sourceRoot":""}